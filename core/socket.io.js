//设置sessionvar session = require("express-session")({  secret: "my-secret",  resave: true,  saveUninitialized: true,  cookie: {maxAge: 1000 * 60 * 30},});var sharedsession = require("express-socket.io-session");module.exports = function (server) {  //io设置服务器  var io = require('socket.io')(server);  //使用session  io.use(sharedsession(session));  //监听消息  io.on("connection", function (socket) {    //登陆聊天服务器    socket.on('login', (chatId) => {      Tools.ioHasLogin(socket.id).then((bool) => {        if (bool) {          io.to(socket.id).emit('cbLogin', {code: 0, message: '您已登陆，请不要重复登录'});        } else {          return Tools.ioLogin(chatId, socket.id);        }      }).then((bool) => {        if (bool) {          // socket.handshake.session.io_sign = socket.id;          io.to(socket.id).emit('cbLogin', {code: 0, message: '登陆成功'});        } else if (bool == false) {          io.to(socket.id).emit('cbLogin', {code: -1, message: '登陆失败'});        }      });    });    //向指定用户发送文本消息    socket.on('sendTxt', (data) => {      Tools.getSocketId(data.to).then(socketId => {        if (socketId) {          io.to(socketId).emit('onMessage', {code: 0, msg: data.msg});        } else {          io.to(socket.id).emit('cbSendTxt', {code: -1, msg: '发送消息失败'});        }      });    });    socket.on('disconnect', function () {      // console.log('？？？离开了聊天室');      //用户断开了连接,退出登录    })  });};